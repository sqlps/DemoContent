USE master ;
GO
-- =====================================================================================================
-- Step 1) Setup Audit
-- =====================================================================================================
CREATE SERVER AUDIT Monitor
   TO FILE ( FILEPATH = 'C:\SQLAUDITS' ) ;
GO
ALTER SERVER AUDIT Monitor WITH (STATE = ON);
GO

USE [clinic]
GO

-- =====================================================================================================
-- Step 2) Setup DB Audit
-- =====================================================================================================
CREATE DATABASE AUDIT SPECIFICATION [DBAudit_SensitiveData]
FOR SERVER AUDIT [Monitor]
ADD (SELECT ON DATABASE::[clinic] BY [ContosoClinicApplication])
WITH (STATE = OFF)
GO

-- =====================================================================================================
-- Step 3) Enable DB Audit
-- =====================================================================================================
Use Clinic
GO

ALTER DATABASE AUDIT SPECIFICATION DBAudit_SensitiveData
WITH (STATE = ON) ;  
GO  


-- =====================================================================================================
-- Step 4) Select from DBO not auditied
-- =====================================================================================================
Select * from Clinic..Patients


-- =====================================================================================================
-- Step 3) Select from application, should be logged in audit
-- =====================================================================================================
